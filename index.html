<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="tutorial.css" />
</head>
<body>
    <div class="container">
        <div class="jumbotron">
            <h1>User Authentication in Slim v3</h1>
            <p>One of the most important compoenents of a web application is user authentication. In this tutorial, we will be providing a small framework as an example to help you get comfortable dealing with basic user login authentication  Let's get started!.</p>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">Step 1: Setting Up A Test Database</div>
            <div class="panel-body">
                <p>
                    First, we need a test database to check user login information against.  Log in to mySQL, then make and shift focus to a new database called test-auth.
                </p>
                <div class="code-example">
                    CREATE DATABASE test_auth;
                    <br/>
                    USE test_auth;
                </div>
                <p>
                    Next, create a table to store user information.  Each entry in the table should have a user_id uniquely identifying it, a username, a password, and a number indicating the type of user (0 for basic privileges, 1 for moderator, 2 for administrator).
                </p>
                <div class="code-example">
                    CREATE TABLE users(
                    <br/>
                    user_id CHAR(8) PRIMARY KEY,
                    <br/>
                    username VARCHAR(50),
                    <br/>
                    password VARCHAR(50),
                    <br/>
                    type TINYINT);
                </div>
                <p>Now, insert a test user into the table.</p>
                <div class="code-example">
                    INSERT INTO users VALUES('12345678',
                    <br />
                    'fluffybunny1',
                    <br />
                    'junebug',
                    <br />
                    0);
                </div>
                <p>
                    We’d like to simulate a basic user’s access to the database.  So, log into MySQL as root and type the following:
                </p>
                <div class="code-example">
                    CREATE USER 'basic_user'@'localhost' IDENTIFIED BY ‘&lt;PASSWORD&gt;’;
                </div>
                <p>
                    This will create a MySQL user named “basic_user” with &lt;PASSWORD&gt; as their password. Users in MySQL allow for you to regulate who has access to what parts of your database. In production, you should store at the very least a hash of the password in the database, but for simplicity’s sake we will present a basic solution for you to build on.
                </p>
                <div class="code-example">GRANT SELECT ON user_auth.* TO basic_user;</div>
                <p>
                    This will grant only the permissions to view the database to the basic users. This is not required, but a good thing to know how to do and be comfortable with. In real practice, a basic user shouldn’t be able to view the users and their passwords, but, for these purposes, they can. You can set up your own permissions as they pertain to your project.
                </p>
                <p>
                    The next step is to define connection settings for the database in /src/settings.php.   In the associative array called 'settings', add a key value pair for the database.
                </p>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">Step 2: Defining Connection Settings for the Test Database</div>
            <div class="panel-body">
                <p>
                    The next step is to define connection settings for the database in /src/settings.php.   In the associative array called 'settings', add a key value pair for the database.
                </p>
                <div class="code-example">
                    'login_dbConn' => [
                    <br />
                    'username' => '&lt;YOUR_MYSQL_USERNAME&gt;',
                    <br />
                    'password' => '&lt;YOUR_MYSQL_PASSWORD&gt;',
                    <br />
                    'host' => 'localhost',
                    <br />
                    'dbname' => 'test_auth',
                    <br />
                    'db' => 'mysql'
                    <br />
                    ]
                </div>
                <p>Then, in /src/dependencies.php, define a new container for the database settings.</p>
                <div class="code-example">
                    $container['login_dbConn'] = function ($c) {
                        <br />
                    	$settings = $c->get('settings')['login_dbConn'];
                        <br />
                        <br />
                    	$connString = $settings['db'] . ':host=' . $settings['host'];
                        <br />
                    	$connString .= ';dbname=' . $settings['dbname'] . ';charset=utf8mb4';
                        <br />
                        <br />
                    	$db = new PDO($connString, $settings['username'], $settings['password']);
                        <br />
                        <br />
                    	return $db;
                        <br />
                    };

                </div>
                <p>This will allow us to easily establish a connection to the database later in the server-side code.</p>

            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">Step 3: Making A Test Login Page</div>
            <div class="panel-body">
                <p>
                    Next, we need to create a test webpage with a basic form that we can use to log in.  In the "templates" directory of your project root, create a new file called "login.phtml".   In this file, we'll start with the bare-bones structure of any html page.
                </p>
                <div class="code-example">
                    &lt;!DOCTYPE&gt;
                    <br />
                    &lt;html&gt;
                    <br />
                    &lt;head&gt;
                    <br />
                    &lt;/head&gt;
                    <br />
                    &lt;body&gt;
                    <br />
                    &lt;/body&gt;
                    <br />
                    &lt;/html&gt;
                </div>
                <p>
                    Between the &lt;body&gt; tags, we're going to create a basic form where the user can enter their username and password in an attempt to log in.
                </p>
                <div class="code-example">
                    &lt;body&gt;
                    <br />
                    	&lt;p&gt;Login&lt;/p&gt;
                        <br />
                    	&lt;form name="loginform" onSubmit="return validateForm();" action="./login" method="post"&gt;
                        <br />
                    	    &lt;label&gt;Username&lt;/label&gt;
                            <br />
                    	    &lt;input type="text" name="usr" placeholder="username"&gt;
                            <br />
                    	    &lt;label&gt;Password&lt;/label&gt;
                            <br />
                    	    &lt;input type="password" name="pword" placeholder="password"&gt;
                            <br />
                    	    &lt;input type="submit" value="Login"/&gt;
                            <br />
                    	&lt;/form&gt;
                        <br />
                    &lt;/body&gt;
                    <br />

                </div>
            </div>
        </div>
    </div>
</body>
</html>
